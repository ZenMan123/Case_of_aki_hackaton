{% extends 'main/html_template.html' %}
{% load static %}
{% load jinja_filters %}
{% block title %} {{ platform.name }} {% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'platforms\css\platform_description.css' %}">
{% endblock %}

{% block content %}

<div class="main-str">
    <div class="str">
        <div class="mypage">
            <div class="photo">

                    <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">

                        <div class="carousel-indicators">
                            {% for file in platform.platformattachment_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}"
                                            class="active" aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                                {% else %}
                                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}"
                                            aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="carousel-inner">
                            {% for file in platform.platformattachment_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <div class="carousel-item active" data-bs-interval="5000">
                                        <div class="aspect-ratio-box-carousel">
                                            <img src="{{ file.file.url }}" class="d-block w-100">
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="carousel-item" data-bs-interval="8000">
                                        <div class="aspect-ratio-box-carousel">
                                            <img src="{{ file.file.url }}" class="d-block w-100">
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions"
                                data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions"
                                data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>

                    <div class="name-company">
                        <p class="p-name">{{ platform.name }}</p>
                        <p class="p-type">{{ platform.categories|split:";"|join:",  "}}</p>
                    </div>


            </div>

        </div>
        
        <div class="cols-info">

            <div class="info">
                <h3>Описание</h3>
                <p style="white-space: pre-wrap">{{ platform.description }}</p>
            </div>

            <div class="tops">
                <h3>Информация о площадке</h3>

                <div class="rating">
                    {% if comments %}
                    <img class="stars" src="{% static 'main\img\star.svg' %}" alt="Рейтинг">
                    <p class="p1"> 4.3</p>
                    <p class="main-p">/5</p>
                    <img class="comment" src="{% static 'main\img\comment.svg' %}">
                    <p class="amount-reviews">{{ comments|length }}</p>
                    {% else %}
                    <img class="stars" src="{% static 'main\img\star.svg' %}" alt="Рейтинг">
                    <p class="main-p">Отзывов пока нет</p>
                    {% endif %}
                </div>
                
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit.
                </p>
            </div>
        </div>

        {% for comment in comments %}
            <div>
                <span class="text-white">{{ comment.text }}</span> <br>
                <span class="text-white">{{ comment.rating }}</span> <br>
                <img src="{{ comment.commentattachment_set.first.file.url }}" class="card-img-top">
            </div>
        {% endfor %}
    </div>
</div>

{% for month in months %}
    {% if forloop.counter == 1 %}
    <div id="month_table_{{ forloop.counter }}" style="display: block">
    {% else %}
    <div id="month_table_{{ forloop.counter }}" style="display: none">
    {% endif %}
    <h1 class="text-white">{{ month.month }}</h1>
   <table class="table table-black table-bordered">
      <thead>
      <tr>
        <th scope="col">M</th>
        <th scope="col">T</th>
        <th scope="col">W</th>
        <th scope="col">T</th>
        <th scope="col">F</th>
        <th scope="col">S</th>
        <th scope="col">S</th>
      </tr>
      </thead>

     <tbody>
         {% for week in month.weeks %}
            <tr>
            {% for event in week %}
                {% if event.time_comparison == "less" %}
                    <td class="text-wrap bg-secondary">
                        <button onclick="timetable_button_click(this)"
                                event_day = {{ event.day }}
                                event_month = {{ event.month }}
                                event_status = "old_event"
                                event_price = {{ event.price }}
                                style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                    </td>
                {% elif event.is_booked %}
                    <td class="text-wrap bg-danger">
                        <button onclick="timetable_button_click(this)"
                                event_day = {{ event.day }}
                                event_month = {{ event.month }}
                                event_status = "booked_event";
                                event_price = {{ event.price }}
                                style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                    </td>
                {% else %}
                    <td class="text-wrap bg-warning">
                        <button onclick="timetable_button_click(this)"
                                event_day = {{ event.day }}
                                event_month = {{ event.month }}
                                event_status = "free_event"
                                event_price = {{ event.price }}
                                style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                    </td>
                {% endif %}
            {% endfor %}
            </tr>
         {% endfor %}
     </tbody>
    </table>
    </div>
    {% endfor %}

    <button id="button_prev_month" type="button" class="btn btn-danger">Посмотреть предыдущий месяц</button>
    <button id="button_next_month" type="button" class="btn btn-danger">Посмотреть следующий месяц</button>

<div id="calendar-window" class="authorize-window">
</div>

<script src="{% static 'platforms\js\platform_description.js' %}"></script>
    
{% endblock %}