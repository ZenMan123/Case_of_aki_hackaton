{% extends 'main/html_template.html' %}
{% load static %}
{% load jinja_filters %}
{% block title %} {{ platform.name }} {% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'platforms\css\platform_description.css' %}">
{% endblock %}

{% block content %}

<!-- <div class="main-str">
    <div class="str">
        <div class="mypage">
            <div class="photo">

                    <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">

                        <div class="carousel-indicators">
                            {% for file in platform.platformattachment_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}"
                                            class="active" aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                                {% else %}
                                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}"
                                            aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="carousel-inner">
                            {% for file in platform.platformattachment_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <div class="carousel-item active" data-bs-interval="5000">
                                        <div class="aspect-ratio-box-carousel">
                                            <img src="{{ file.file.url }}" class="d-block w-100">
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="carousel-item" data-bs-interval="8000">
                                        <div class="aspect-ratio-box-carousel">
                                            <img src="{{ file.file.url }}" class="d-block w-100">
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions"
                                data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions"
                                data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>

                    <div class="name-company">
                        <p class="p-name">{{ platform.name }}</p>
                        <p class="p-type">{{ platform.categories|split:";"|join:",  "}}</p>
                    </div>


            </div>

        </div>
        
        <div class="cols-info">

            <div class="info">
                <h3>Описание</h3>
                <p style="white-space: pre-wrap">{{ platform.description }}</p>
            </div>

            <div class="tops">
                <h3>Информация о площадке</h3>

                <div class="rating">
                    {% if comments %}
                    <img class="stars" src="{% static 'main\img\star.svg' %}" alt="Рейтинг">
                    <p class="p1"> 4.3</p>
                    <p class="main-p">/5</p>
                    <img class="comment" src="{% static 'main\img\comment.svg' %}">
                    <p class="amount-reviews">{{ comments|length }}</p>
                    {% else %}
                    <img class="stars" src="{% static 'main\img\star.svg' %}" alt="Рейтинг">
                    <p class="main-p">Отзывов пока нет</p>
                    {% endif %}
                </div>
                
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit.
                </p>
            </div>
        </div>

        {% for comment in comments %}
            <div>
                <span class="text-white">{{ comment.text }}</span> <br>
                <span class="text-white">{{ comment.rating }}</span> <br>
                <img src="{{ comment.commentattachment_set.first.file.url }}" class="card-img-top">
            </div>
        {% endfor %}
    </div>
</div>
 -->
<div>
    <!-- <head>
      <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    </head> -->
    <div class="month">
      <div id="calendar">
        <div id="calendar_header"><i class="icon-chevron-left"></i>
            <h1></h1><i class="icon-chevron-right"></i>         
        </div>
        <div id="calendar_weekdays"></div>
        <div id="calendar_content"></div>
      </div>
    </div>

    <script type="text/javascript">
        $(function () {
    function c() {
        p();
        var e = h();
        var r = 0;
        var u = false;
        l.empty();
        while (!u) {
            if (s[r] == e[0].weekday) {
                u = true
            } else {
                l.append('<div class="blank"></div>');
                r++
            }
        }
        for (var c = 0; c < 42 - r; c++) {
            if (c >= e.length) {
                l.append('<div class="blank"></div>')
            } else {
                var v = e[c].day;
                var m = g(new Date(t, n - 1, v)) ? '<div class="today">' : "<div>";
                l.append(m + "" + v + "</div>")
            }
        }
        var y = o[n - 1];
        a.css("background-color", y).find("h1").text(i[n - 1] + " " + t);
        f.find("div").css("color", y);
        l.find(".today").css("background-color", y);
        d()
    }

    function h() {
        var e = [];
        for (var r = 1; r < v(t, n) + 1; r++) {
            e.push({day: r, weekday: s[m(t, n, r)]})
        }
        return e
    }

    function p() {
        f.empty();
        for (var e = 0; e < 7; e++) {
            f.append("<div>" + s[e].substring(0, 3) + "</div>")
        }
    }

    function d() {
        var t;
        var n = $("#calendar").css("width", e + "px");
        n.find(t = "#calendar_weekdays, #calendar_content").css("width", e + "px").find("div").css({
            width: e / 7 + "px",
            height: e / 7 + "px",
            "line-height": e / 7 + "px"
        });
        n.find("#calendar_header").css({height: e * (1 / 7) + "px"}).find('i[class^="icon-chevron"]').css("line-height", e * (1 / 7) + "px")
    }

    function v(e, t) {
        return (new Date(e, t, 0)).getDate()
    }

    function m(e, t, n) {
        return (new Date(e, t - 1, n)).getDay()
    }

    function g(e) {
        return y(new Date) == y(e)
    }

    function y(e) {
        return e.getFullYear() + "/" + (e.getMonth() + 1) + "/" + e.getDate()
    }

    function b() {
        var e = new Date;
        t = e.getFullYear();
        n = e.getMonth() + 1
    }

    var e = 480;
    var t = 2013;
    var n = 9;
    var r = [];
    var i = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
    var s = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    var o = ["#16a085", "#1abc9c", "#c0392b", "#27ae60", "#FF6860", "#f39c12", "#f1c40f", "#e67e22", "#2ecc71", "#e74c3c", "#d35400", "#2c3e50"];
    var u = $("#calendar");
    var a = u.find("#calendar_header");
    var f = u.find("#calendar_weekdays");
    var l = u.find("#calendar_content");
    b();
    c();
    a.find('i[class^="icon-chevron"]').on("click", function () {
        var e = $(this);
        var r = function (e) {
            n = e == "next" ? n + 1 : n - 1;
            if (n < 1) {
                n = 12;
                t--
            } else if (n > 12) {
                n = 1;
                t++
            }
            c()
        };
        if (e.attr("class").indexOf("left") != -1) {
            r("previous")
        } else {
            r("next")
        }
    })
})
    </script>
</div>


<!-- <div class="month">
    {% for month in months %}
    {% if forloop.counter == 1 %}
    <div id="month_table_{{ forloop.counter }}" style="display: block">
    {% else %}
    <div id="month_table_{{ forloop.counter }}" style="display: none">
    {% endif %}
    <h1 class="text-white">{{ month.month }}</h1>
    <table class="table table-black table-bordered">
      <thead>
      <tr>
        <th scope="col">M</th>
        <th scope="col">T</th>
        <th scope="col">W</th>
        <th scope="col">T</th>
        <th scope="col">F</th>
        <th scope="col">S</th>
        <th scope="col">S</th>
      </tr>
      </thead>

        <tbody>
             {% for week in month.weeks %}
                <tr>
                {% for event in week %}
                    {% if event.time_comparison == "less" %}
                        <td class="text-wrap bg-secondary">
                            <button onclick="timetable_button_click(this)"
                                    event_day = {{ event.day }}
                                    event_month = {{ event.month }}
                                    event_month_text = {{ event.month_text }}
                                    event_status = "old_event"
                                    event_year = {{ event.year }}
                                    disabled
                                    title="На этот слот уже нельзя записаться"
                                    event_price = {{ event.price }}
                                    style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                        </td>
                    {% elif event.is_booked %}
                        <td class="text-wrap bg-danger">
                            <button onclick="timetable_button_click(this)"
                                    event_day = {{ event.day }}
                                    event_month = {{ event.month }}
                                    event_month_text = {{ event.month_text }}
                                    event_status = "booked_event"
                                    event_year = {{ event.year }}
                                    disabled
                                    title="Этот слот уже занят"
                                    event_price = {{ event.price }}
                                    style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                        </td>
                    {% else %}
                        <td class="text-wrap bg-warning">
                            <button onclick="timetable_button_click(this)"
                                    event_day = {{ event.day }}
                                    event_month = {{ event.month }}
                                    event_month_text = {{ event.month_text }}
                                    event_year = {{ event.year }}
                                    event_status = "free_event"
                                    event_price = {{ event.price }}
                                    style="background: #E74362">{{ event.day }} {% if event.time_comparison == "equal" %} TODAY {% endif %}</button>
                        </td>
                    {% endif %}
                {% endfor %}
                </tr>
             {% endfor %}
        </tbody>
    </table>
    </div>
    {% endfor %}

    <button id="button_prev_month" type="button" class="btn btn-danger">Посмотреть предыдущий месяц</button>
    <button id="button_next_month" type="button" class="btn btn-danger">Посмотреть следующий месяц</button>

    <div id="calendar-window" class="authorize-window">
        <div id="calendar-window-form" class="calendar-window-form">
            <h2 id="date-paragraph-calendar-window-form"></h2>
            <h2 id="price-paragraph-calendar-window-form"></h2>
            <h2 id="status-paragraph-calendar-window-form"></h2>
            <a href="#" id="file-paragraph-calendar-window-form" download>Скачать оферту</a>

            {% if user_fields.client %}
            <form id="user-client-register-form" method="post" action="{{ url_path }}">
                <div style="display: none">
                    <input id="__calendar_entry_request" name="__calendar_entry_request">
                    <input id="__platform_id" name="__platform_id" type="number" value={{ platform.id }}>
                    <input id="__day" name="__day" type="number" value={{ platform.id }}>
                    <input id="__month" name="__month" type="number">
                    <input id="__year" name="__year" type="number">
                </div>

                {% csrf_token %}
                <button type="submit">Забронировать</button>
            </form>
            {% elif user_fields.organizer %}
            <form method="post">
                <input name="__calendar_entry_request" type="hidden">
                {% csrf_token %}
                <button disabled type="submit">Арендодатель не может бронировать слоты</button>
            </form>
            {% else %}
            <form method="post">
                <input name="__calendar_entry_request" type="hidden">
                {% csrf_token %}
                <button id="login_calendar_registrate_button" type="button">Войти</button>
            </form>
            {% endif %}
        </div>
    </div>
    
</div>
 -->
<!--  <button id="button_prev_month" type="button" class="btn btn-danger">Посмотреть предыдущий месяц</button>

<button id="button_next_month" type="button" class="btn btn-danger">Посмотреть следующий месяц</button>
<script src="{% static 'platforms\js\platform_description.js' %}"></script> -->
    
{% endblock %}